Bootstrap: docker
From: ubuntu:22.04 

%labels
    APPLICATION_NAME MET-tools-py - Ubuntu 2022.04
    APPLICATION_URL 
    APPLICATION_VERSION 1.0

    AUTHOR_NAME Colin Grudzien
    AUTHOR_EMAIL cgrudzien@ucsd.edu

    LAST_UPDATED 2024.01.31

%files
./MET-tools-py.yml /opt

%post -c /bin/bash
    # run verbose
    set -x

    printf "===========\n"
    printf "Create minimal environment for the container installation\n"
    apt-get update
    apt-get -y install curl
    apt-get -y install tar

    printf "===========\n"
    printf "===========\n"
    printf "Prepare micromamba installation\n"
    mmpath=/opt/Micromamba
    mkdir -p ${mmpath}
    cd ${mmpath}
    curl -Ls https://micro.mamba.pm/api/micromamba/linux-64/latest | tar -xvj bin/micromamba
    export MAMBA_ROOT_PREFIX=/opt/Micromamba/bin
    eval "$(./bin/micromamba shell hook -s posix)"
    ${mmpath}/bin/micromamba shell init -s bash -p ${mmpath}
    alias mm=micromamba

    printf "===========\n"
    printf "===========\n"
    printf "Install packages"
    mm create -f MET-tools-py.yml

    printf "===========\n"
    printf "===========\n"
    printf "Cleaning environment\n"

    printf "===========\n"
    printf "===========\n"
    printf "Completed installation of MET-tools-py\n"
%runscript
    /bin/bash
    mmpath=/opt/Micromamba
    export MAMBA_ROOT_PREFIX=/opt/Micromamba/bin
    eval "$(./bin/micromamba shell hook -s posix)"
    ${mmpath}/bin/micromamba shell init -s bash -p ${mmpath}
    alias mm=micromamba
    mm activate MET-tools-py

%test
