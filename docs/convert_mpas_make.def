Bootstrap: docker
From: ubuntu:22.04 

%labels
    APPLICATION_NAME convert_mpas - Ubuntu 2022.04
    APPLICATION_URL 
    APPLICATION_VERSION 1.0

    AUTHOR_NAME Colin Grudzien
    AUTHOR_EMAIL cgrudzien@ucsd.edu

    CO_AUTHOR_NAME Jozette Conti
    CO_AUTHOR_EMAIL jlconti@ucsd.edu

    CO_AUTHOR_NAME Patrick Mulrooney
    CO_AUTHOR_EMAIL pmulrooney@ucsd.edu

    LAST_UPDATED 2024.08.02

%files

%environment

%post -c /bin/bash
    # run verbose
    set -x

    # Create minimal environment for the container installation
    apt-get update
    apt-get -y install build-essential
    apt-get -y install vim
    apt-get -y install wget
    apt-get -y install unzip
    apt-get -y install gcc
    apt-get -y install gfortran
    apt-get -y install make
    apt-get -y install curl
    apt-get -y install libcurl4-gnutls-dev
    apt-get -y install libxml2-dev
    apt-get -y install m4
    apt-get -y install gawk
    apt-get -y install valgrind
    apt-get -y install libzstd-dev

    export ZLIB_DIR=/usr/local
    export ZLIB_ROOT=${ZLIB_DIR}
    cd ${ZLIB_DIR}
    
    wget https://www.zlib.net/zlib-1.3.1.tar.gz
    zlib_sha=9a93b2b7dfdac77ceba5a558a580e74667dd6fede4585b91eefb60f03b72df23
    echo "${zlib_sha} zlib-1.3.1.tar.gz" > zlib-1.3.1.tar.gz.sha256
    sha256sum --strict --status -c zlib-1.3.1.tar.gz.sha256
    error=$?
    if [ ${error} -ne 0 ]; then
      exit ${error}
    fi
    tar -xvf zlib-1.3.1.tar.gz
    cd zlib-1.3.1
    make distclean
    ./configure --prefix=${ZLIB_DIR}
    make check install

    export HDF5_DIR=/usr/local 
    cd ${HDF5_DIR}

    wget https://hdf-wordpress-1.s3.amazonaws.com/wp-content/uploads/manual/HDF5/HDF5_1_14_3/src/hdf5-1.14.3.tar.gz
    wget https://hdf-wordpress-1.s3.amazonaws.com/wp-content/uploads/manual/HDF5/HDF5_1_14_3/src/hdf5-1.14.3.tar.gz.sha256

    sha256sum --strict --status -c hdf5-1.14.3.tar.gz.sha256
    error=$?
    if [ ${error} -ne 0 ]; then
      exit ${error}
    fi
    tar -xvf hdf5-1.14.3.tar.gz
    cd hdf5-1.14.3
    #mkdir build
    #cd build

    # Build and install HDF5
    ./configure --with-zlib=${ZLIB_DIR} --prefix=${HDF5_DIR} --enable-hl --enable-build-mode=production
    make check install

    export NC4_DIR=/usr/local
    cd ${NC4_DIR}
    wget https://github.com/Unidata/netcdf-c/archive/refs/tags/v4.9.2.tar.gz
    tar -xvf v4.9.2.tar.gz
    cd netcdf-c-4.9.2
    # Build and install netCDF-4
    export CPPFLAGS="-I${HDF5_DIR}/include"
    export LDFLAGS="-L${HDF5_DIR}/lib"
    export LD_LIBRARY_PATH="${HDF5_DIR}/lib:${LD_LIBRARY_PATH}"
    ./configure --prefix=${NC4_DIR}
    make check
    #make install 
    # https://github.com/mgduda/convert_mpas/archive/refs/heads/master.zip
    #cd convert_mpas-master
    #make

%test
