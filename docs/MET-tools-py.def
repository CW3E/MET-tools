Bootstrap: docker
From: ubuntu:22.04 

%labels
    APPLICATION_NAME MET-tools-py - Ubuntu 2022.04
    APPLICATION_URL 
    APPLICATION_VERSION 1.0

    AUTHOR_NAME Colin Grudzien
    AUTHOR_EMAIL cgrudzien@ucsd.edu

    CO_AUTHOR_NAME Jozette Conti
    CO_AUTHOR_EMAIL jlconti@ucsd.edu

    CO_AUTHOR_NAME Patrick Mulrooney
    CO_AUTHOR_EMAIL pmulrooney@ucsd.edu

    LAST_UPDATED 2024.02.01

%files
    ./MET-tools-py.yml /opt

%environment
    # export the path to python environment
    export PATH=/opt/Micromamba:${PATH}

    # export generic path to bind work scripts / modules to
    export PYTHONPATH=/scrpt_dir


%post -c /bin/bash
    # run verbose
    set -x
    printf "Create minimal environment for the container installation\n"
    apt-get update
    apt-get -y install wget
    apt-get -y install find
    apt-get -y install vim

    mkdir -p /opt/miniconda3
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O /opt/miniconda3/miniconda.sh
    bash /opt/miniconda3/miniconda.sh -b -u -p /opt/miniconda3
    rm -rf ~/miniconda3/miniconda.sh
    . /opt/miniconda3/etc/profile.d/conda.sh
    conda env create -y -f /opt/MET-tools-py.yml

    printf ". /opt/miniconda3/etc/profile.d/conda.sh\n" >> $SINGULARITY_ENVIRONMENT
    printf "conda activate MET-tools-py\n" >> $SINGULARITY_ENVIRONMENT
%test
